{% load wagtailimages_tags i18n homepage_tags %}

{% if page.featured_blogs.all.count > 0 %}
{% with page.featured_blogs.all as featured_blogs %}
<div class="row">
  <div class="col mb-4">
    <hr class="mb-4 hr-emphasis mt-0">
    <h4 class="h4-heading">{% trans "Latest news" %}</h4>
  </div>
</div>
<div class="row mb-3">
  {% for blog in featured_blogs %}
  {% if forloop.counter is 1 %}
  <div class="col-md-6 mb-0 pb-4">
    <div>
      {% image blog.blog.specific.get_meta_image width-540 %}
    </div>
    <div class="row">
      <div class="col-12 full-bleed-xs">
        <div class="key-item mx-2 mx-md-4 p-3">
          <h5 class="mb-2 h3-heading">
            <a href="{{blog.blog.url}}">{{blog.blog.title}}</a>
          </h5>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  {% endfor %}


  {% if featured_blogs|length > 1 %}
  <div class="col-md-6 mb-0 pb-4">
    {% for blog in featured_blogs %}
    {% get_all_authors blog as authors %}

    {% if forloop.counter > 1 %}
    <div>
      <h5 class="mb-2">
        <a href="{{blog.blog.url}}">{{blog.blog.title}}</a>
      </h5>
      <div class="body-small mb-2">

{# TODO: Export this internal CSS to .scss #}
<style>
  .featured-blog-author-image {
    display: inline-block;
    width: 50px;
    height: 50px;
    position: relative;
    margin-left: -16px;
    border-radius: 50%;
    text-align: center;
    text-transform: uppercase;
    background-color: orange;
    display: inline-block;
    border: 2px solid #fff;
  }
</style>
        {% for author in authors %}
          {% if author.image %}
            {% image author.image fill-50x50 as img %}
            <img src="{{ img.url }}" class="featured-blog-author-image" alt="{{ author.name }}" />
          {% else %}
            <div class="featured-blog-author-image" style='z-index: {{ forloop.counter }};'>
              {{ author.name|make_list|first }}
            </div>
          {% endif %}
        {% endfor %}

        {% for author in authors %}
          {% if forloop.last %} {% trans "and" %} {% endif %}<strong>{{ author.name }}{% if not forloop.last %}, {% endif %}</strong>
        {% endfor %}
      </div>
      <hr>
    </div>
    {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>
<div class="row">
  <div class="col text-center mb-5">
    <a class="btn btn-secondary" href="/blog">{% trans "More from our blog" %}</a>
  </div>
</div>
{% endwith %}
{% endif %}
