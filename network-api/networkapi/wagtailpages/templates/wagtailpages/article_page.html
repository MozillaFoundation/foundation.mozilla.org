{% extends "pages/base.html" %}
{% load wagtailcore_tags i18n %}

{% block primary_nav %}
  {{ block.super }}

  {# TODO Move this subnav to a fragment #}
  <div class="article-navbar">
    <div class="container">
      <div class="row">
        <div class="col">
          <div class="d-flex flex-row justify-content-between">
            <div class="article-navbar-title col-sm-8">{{ page.title|truncatechars:60 }}</div>
            <div class="article-navbar-summary col-sm-4">

              {% if page.get_titles %}
                <div class="dropdown">
                  <a class="btn btn-sm btn-link dropdown-toggle article-summary-toggle d-block text-left" href="#" role="button" id="summaryMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Summary
                  </a>

                  <div class="dropdown-menu dropdown-menu-right d-block w-100 article-summary-menu" aria-labelledby="summaryMenu">
                    {% for slug, header in page.get_titles %}
                      <a class="dropdown-item" href="#{{ slug }}">{{ header }}</a>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}


{% block content %}

  <div class="container">
    <div class="row">
      <div class="offset-sm-1 col-sm-10 col-12 article-blocks">

        {% if page.get_titles %}
          <div class="article-summary">
            <div class="article-summary-title">{% trans 'SUMMARY' %}</div>
            <div class="article-links">
              {% for slug, header in page.get_titles %}
                <a href="#{{ slug }}" class="article-summary-link">{{ header }}</a>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% for block in page.body %}
          {% include_block block with is_last=forloop.last %}
        {% endfor %}
      </div>
    </div>
  </div>

  {% if page.footnotes_list %}
    <div class="container footnotes">
      <div class="row">
        <div class="col-sm-10 offset-1">
          <h3 class="footnotes-title">Footnotes</h3>
          {% for footnote in page.footnotes_list %}
            <div class="footnote-row d-flex" id="footnote-{{ forloop.counter }}">
              <a href="#footnote-source-{{ forloop.counter }}" class="footnote-number mr-3" aria-label="Back to content">
                [{{ forloop.counter }}]
              </a>
              <a href="#footnote-source-{{ forloop.counter }}" class="footnote-text" aria-label="Back to content">
                {{ footnote.text|richtext }}
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}

  <div class="article-prev-next">
    <div class="container">
      <div class="row d-flex">
        <div class="col-sm-6 text-sm-right article-prev article-nav-arrow article-nav-arrow--left">
          {% if page.prev_page %}
            <small class="prev-next-text">Previous</small>
            <a href="{{ page.prev_page.url }}" class="article-prev-next-link">
              {{ page.prev_page.title }}
            </a>
          {% endif %}
        </div>
        <div class="col-sm-6 article-next article-next-arrow article-nav-arrow article-nav-arrow--right">
          {% if page.next_page %}
            <small class="prev-next-text">Next</small>
            <a href="{{ page.next_page.url }}" class="article-prev-next-link">
              {{ page.next_page.title }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

{% endblock %}
