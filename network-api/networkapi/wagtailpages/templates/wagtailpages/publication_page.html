{% extends "pages/base.html" %}
{% load wagtailimages_tags %}

{% block content%}
    <div class="container">

        <div
        class="row mb-5 mt-0 mt-sm-5 d-flex align-items-center">
            {% comment %} <div class="col-sm-6 mb-3 mb-sm-0">
                {% image page.hero_image fill-1240x625 %}1
            </div> {% endcomment %}

            <div class="col-sm-10">

                <h1 class="h1-heading">
                    {{ page.title }}
                </h1>

                <div class="body-large mb-4">
                    {% if page.subtitle %}
                        {{ page.subtitle }}
                    {% endif %}
                </div>

                <div class="body-large mb-4">

                    {% if page.secondary_subtitle %}
                        {{ page.secondary_subtitle }}
                        {% endif%}
                    </div>
                    {% if page.publication_date %}
                        {{ page.publication_date }}
                    {% endif %}

                    {% if page.publication_file %}

                        <a
                        class="btn btn-primary d-block"
                        href="{{ page.publication_file.url }}">
                        Download Full PDF
                        </a>
                        {% if page.publication_file.file_size %}
                            {{page.publication_file.file_size}}
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        {{ page.contents_title }}

    {% if page.is_chapter_page %}
      {# Chapter index page; display child article pages #}
      <div class="container-sm background-white chapter-body">
        {% for child in page.get_child_article_pages %}
          <div class="row d-flex align-items-center">
            <div class="col">
              <div class="chapter-number">
                <div>
                  {{ page.get_chapter_number_or_none }}.{{ forloop.counter }}
                </div>
              </div>
            </div>
            <div class="col-md-11">
              <a href="{{ child.url }}" class="d-block w-100 h3 chapter-article-link">
                {{ child.title }}
              </a>
            </div>
            {% if not forloop.last %}
              <div class="col-12 my-3">
                <hr>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      {# Publication page #}
      <div class="child-pages-summary">
      {% comment %} https://django-treebeard.readthedocs.io/en/stable/api.html#treebeard.models.Node.get_annotated_list {% endcomment %}
        {% for child, node_info in page.my_children %}
            {% comment %} 'open' means 'there are siblings so open the list tag' {% endcomment %}
            {% if node_info.open %}
                <ol><li>
            {% else %}
                </li><li>
            {% endif %}
            <a href="{{ child.url }}" class="d-block w-100 h3 chapter-article-link">
            {{ child.title }}
            </a>

            {% comment %} these are the 'last' elements in the tree {% endcomment %}
            {% for close in node_info.close %}
                </li></ol>
            {% endfor %}
        {% endfor %}
      </div>
    {% endif %}

{% endblock %}
