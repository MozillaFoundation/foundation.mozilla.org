{% extends "pages/base.html" %}
{% load wagtailcore_tags wagtailimages_tags homepage_tags card_tags wagtailmetadata_tags multi_image_tags i18n %}

{% block body_id %}home{% endblock %}

{% block org_schema %}
  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Organization",
      "legalName" : "Mozilla Foundation",
      "url" : "https://foundation.mozilla.org",
      "logo" : "https://foundation.mozilla.org/_images/mozlogo.jpg"
    }
  </script>
{% endblock %}

{% block content %}
<div class="container">
  <div class="row mb-5 mt-0 mt-sm-5 d-flex align-items-center flex-sm-row-reverse homepage-feature">
    <div class="col-sm-6 mb-3 mb-sm-0">
      {% optimize_images page.hero_image %}
    </div>
    <div class="col-sm-6">
      <h1 class="h1-heading">{{ page.hero_headline }}</h1>
      <div class="body-large mb-4">{{ page.hero_story_description | richtext }}</div>
      <a class="btn btn-primary d-block d-sm-inline" href="{{page.hero_button_url}}">{{ page.hero_button_text }}</a>
    </div>
  </div>

  {% include "./fragments/featured_blogs.html" %}

  <div class="row">
    <div class="col mb-4">
      <hr class="hr-emphasis mb-4">
      <h2 class="h4-heading">{% trans "Featured stories" %}</h2>
    </div>
  </div>
  <div id="home-highlights-wagtail">
    <div class="highlights mb-5">
      <div class="row pb-md-5 mb-md-2">
        {% for highlight in page.featured_highlights.all %}
        {% if forloop.counter <= 2 %}
        <div class="col-md-6 highlights-card">
          {% card highlight.highlight.image.url highlight.highlight.title highlight.highlight.description highlight.highlight.link_url highlight.highlight.link_label %}
        </div>
      {% endif %} {% endfor %}
      </div>
      {% for highlight in page.featured_highlights.all %} {% if forloop.counter > 2 %}
      <div class="row my-3">
        <div class="col-sm-12 col-md-4 pt-3 d-none d-md-block">
          {% homepage_image highlight.highlight.image %}
        </div>
        <div class="col-sm-12 col-md-8 pt-3">
          <hr class="mt-0 mb-4">
          <h4 class="h5-heading mb-3">
            <a href="{{highlight.highlight.link_url}}">{{highlight.highlight.title}}</a>
          </h4>
          <p>{{highlight.highlight.description}}</p>
        </div>
      </div>
      {% endif %} {% endfor %}
    </div>
  </div>
  <div class="row">
    <div class="col">
      <hr class="hr-emphasis mb-4">
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="h4-heading">{% trans "Trending projects" %}</h2>
    </div>
    <div class="col-md-6 d-none d-md-flex justify-content-end">
      <a class="cta-link" href="https://www.mozillapulse.org/add">{% trans "Add your project" %}</a>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <div class="pulse-project-list" data-query="" data-max="6" data-featured="True" data-reversed="True"></div>
    </div>
  </div>
  <div class="row">
    <div class="col text-center mb-5">
      <a class="btn btn-secondary mb-4" href="https://www.mozillapulse.org">{% trans "More from our network" %}</a>
      <a class="cta-link d-block d-md-none" href="https://www.mozillapulse.org/add">{% trans "Add your project" %}</a>
    </div>
  </div>
  <div class="row section-quote">
    {% with quote_image=page.quote_image %}
    {% if quote_image %}
    <div class="col-md-4 col-lg-6 mb-5 mb-md-0">
      {% comment %}
        To-do:
        1) Update picture_ratios.html so image sizes are passed as arguments instead of hard-corded.
        2) Replace the following "picture" code with {% optimize_images page.quote_image %}
      {% endcomment %}
      {% with alt_text=quote_image.alt %}
      <picture class="cms-image {{class_names}}">
          {% image quote_image width-540 as image_large %}
          {% image quote_image width-1080 as image_large_2x %}
          <source media="(min-width: 992px)" srcset="{{ image_large.url }}, {{ image_large_2x.url }} 2x"  alt="{{ alt_text }}">

          {% image quote_image width-210 as image_medium %}
          {% image quote_image width-420 as image_medium_2x %}
          <source media="(min-width: 768px)" srcset="{{ image_medium.url }}, {{ image_medium_2x.url }} 2x" alt="{{ alt_text }}">

          {% image quote_image width-510 as image_small %}
          {% image quote_image width-1020 as image_small_2x %}
          <source srcset="{{ image_small.url }}, {{ image_small_2x.url }} 2x" alt="{{ alt_text }}">

          <img src="{{ image_large.url }}" class="wagtail-image" srcset="{{image_small.url}} 510w, {{ image_medium.url }} 210w, {{ image_large.url }} 540w" alt="{{ alt_text }}"/>
      </picture>
      {% endwith %}
    </div>
    {% endif %}
    {% endwith %}
    <div class="col-md-8 col-lg-6">
      <blockquote>
        <p class="quote-text">{{ page.quote_text }}</p>
        <footer>
          <cite>{{ page.quote_source_name }}</cite>
          <p>{{ page.quote_source_job_title }}</p>
        </footer>
      </blockquote>
    </div>
  </div>

</div>

{% endblock %}
