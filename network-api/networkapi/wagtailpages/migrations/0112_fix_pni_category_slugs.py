# Generated by Django 3.2.21 on 2023-10-11 12:39

from django.conf import settings
from django.db import migrations


def fix_pni_category_slugs(apps, schema_editor):
    """Fix slugs so that they sync with the original category slugs."""
    BuyersGuideProductCategory = apps.get_model("wagtailpages", "BuyersGuideProductCategory")

    original_categories = BuyersGuideProductCategory.objects.filter(locale__language_code=settings.LANGUAGE_CODE)

    for original_category in original_categories:
        BuyersGuideProductCategory.objects.filter(translation_key=original_category.translation_key).update(
            slug=original_category.slug
        )


class Migration(migrations.Migration):
    dependencies = [
        ("wagtailpages", "0111_alter_productpagecategory_category"),
    ]

    operations = [
        migrations.RunPython(fix_pni_category_slugs, migrations.RunPython.noop),
    ]
