# Generated by Django 4.2.15 on 2024-09-11 06:29

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


def update_focus_areas_and_add_hero_bottom(apps, schema_editor):
    FocusArea = apps.get_model("wagtailpages", "FocusArea")
    Homepage = apps.get_model("wagtailpages", "Homepage")
    Page = apps.get_model("wagtailcore", "Page")
    Locale = apps.get_model("wagtailcore", "Locale")

    # Get the default locale
    DEFAULT_LOCALE = Locale.objects.get(language_code=settings.LANGUAGE_CODE)
    locale_id = DEFAULT_LOCALE.pk

    # Update FocusArea data
    focus_areas = [
        {"name": "$25.2 million", "description": "in grants given to support fellows", "locale_id": locale_id},
        {"name": "150 fellows", "description": "shaping technology in the public interest", "locale_id": locale_id},
        {
            "name": "100,000+ signatures",
            "description": "on petitions holding companies accountable",
            "locale_id": locale_id,
        },
    ]

    existing_focus_areas = list(FocusArea.objects.all())

    for index, data in enumerate(focus_areas):
        if index < len(existing_focus_areas):
            focus_area = existing_focus_areas[index]
            focus_area.name = data["name"]
            focus_area.description = data["description"]
            focus_area.save()
        else:
            FocusArea.objects.create(**data)

    # Add hero_bottom data to Homepage
    homepage = Homepage.objects.first()
    if homepage:
        homepage.hero_bottom_heading = (
            "A healthy internet is one in which privacy, openness, and inclusion are the norms. "
        )
        homepage.hero_bottom_body = "Mozilla empowers consumers to demand better online privacy, trustworthy AI, and safe online experiences from Big Tech and governments. We work across borders, disciplines, and technologies to uphold principles like privacy, inclusion and decentralization online."
        homepage.hero_bottom_link_text = "More about our mission"
        homepage.hero_bottom_link_page = Page.objects.filter(depth=2).first()
        homepage.save()


class Migration(migrations.Migration):

    dependencies = [
        ("wagtailcore", "0089_log_entry_data_json_null_to_object"),
        ("wagtailpages", "0161_alter_homepage_ideas_headline_and_more"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="focusarea",
            name="page",
        ),
        migrations.RemoveField(
            model_name="homepage",
            name="cause_statement",
        ),
        migrations.RemoveField(
            model_name="homepage",
            name="cause_statement_link_page",
        ),
        migrations.RemoveField(
            model_name="homepage",
            name="cause_statement_link_text",
        ),
        migrations.RemoveField(
            model_name="homepage",
            name="show_cause_statement",
        ),
        migrations.AddField(
            model_name="homepage",
            name="hero_bottom_body",
            field=models.TextField(blank=True, max_length=300),
        ),
        migrations.AddField(
            model_name="homepage",
            name="hero_bottom_heading",
            field=models.CharField(blank=True, max_length=100),
        ),
        migrations.AddField(
            model_name="homepage",
            name="hero_bottom_link_page",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="hero_bottom_link",
                to="wagtailcore.page",
            ),
        ),
        migrations.AddField(
            model_name="homepage",
            name="hero_bottom_link_text",
            field=models.CharField(blank=True, max_length=50),
        ),
        migrations.RunPython(update_focus_areas_and_add_hero_bottom),
    ]
