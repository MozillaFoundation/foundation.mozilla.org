# Generated by Django 2.2.5 on 2019-10-09 00:10

from django.db import migrations, models


# We can't rely on the @property in the Product class,
# as the Product object that Django constructs is purely
# based on the database schema during migrations.
def numeric_reading_grade(product):
    try:
        return int(product.privacy_policy_reading_level)
    except ValueError:
        return 0

# Make sure to correctly set the "user-friendly privacy policy?"
# field based on the old reading grade string.
def bootstrap_ufpp(apps, schema_editor):
    Product = apps.get_model("buyersguide", "Product")
    for product in Product.objects.all():
        rating = 'No'
        grade = numeric_reading_grade(product)
        if grade == 0:
            rating = 'NA'
        elif grade <= 12:
            rating = 'Yes'
        product.user_friendly_privacy_policy = rating
        product.save()


class Migration(migrations.Migration):

    dependencies = [
        ('buyersguide', '0024_update_product_fields_2019'),
    ]

    operations = [
        migrations.RunPython(bootstrap_ufpp, migrations.RunPython.noop),
    ]
