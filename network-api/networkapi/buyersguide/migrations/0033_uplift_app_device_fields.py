# Generated by Django 2.2.5 on 2019-11-06 20:11

from django.db import migrations
import networkapi.buyersguide.fields
from networkapi.buyersguide.utils import tri_to_quad, quad_to_tri

def copy_tri_to_quad(apps, schema_editor):
    Product = apps.get_model("buyersguide", "Product")
    for product in Product.objects.all():
        product.camera_app_temp = tri_to_quad(product.camera_app)
        product.camera_device_temp = tri_to_quad(product.camera_device)
        product.microphone_app_temp = tri_to_quad(product.microphone_app)
        product.microphone_device_temp = tri_to_quad(product.microphone_device)
        product.location_app_temp = tri_to_quad(product.location_app)
        product.location_device_temp = tri_to_quad(product.location_device)
        product.save()

def copy_quad_to_tri(apps, schema_editor):
    Product = apps.get_model("buyersguide", "Product")
    for product in Product.objects.all():
        product.camera_app = quad_to_tri(product.camera_app_temp)
        product.camera_device = quad_to_tri(product.camera_device_temp)
        product.microphone_app = quad_to_tri(product.microphone_app_temp)
        product.microphone_device = quad_to_tri(product.microphone_device_temp)
        product.location_app = quad_to_tri(product.location_app_temp)
        product.location_device = quad_to_tri(product.location_device_temp)
        product.save()


class Migration(migrations.Migration):

    dependencies = [
        ('buyersguide', '0032_product_user_friendly_privacy_policy_helptext'),
    ]

    operations = [
        # introduce temporary fields

        migrations.AddField(
            model_name='product',
            name='camera_app_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does the app have or access a camera?'),
        ),
        migrations.AddField(
            model_name='product',
            name='camera_device_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does this device have or access a camera?'),
        ),
        migrations.AddField(
            model_name='product',
            name='location_app_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does this app access your location?'),
        ),
        migrations.AddField(
            model_name='product',
            name='location_device_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does this product access your location?'),
        ),
        migrations.AddField(
            model_name='product',
            name='microphone_app_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does this app have or access a microphone?'),
        ),
        migrations.AddField(
            model_name='product',
            name='microphone_device_temp',
            field=networkapi.buyersguide.fields.ExtendedYesNoField(help_text='Does this Device have or access a microphone?'),
        ),

        # perform data conversion for new field type

        migrations.RunPython(copy_tri_to_quad, copy_quad_to_tri),

        # remove original fields

        migrations.RemoveField(
            model_name='product',
            name='camera_app',
        ),
        migrations.RemoveField(
            model_name='product',
            name='camera_device',
        ),
        migrations.RemoveField(
            model_name='product',
            name='location_app',
        ),
        migrations.RemoveField(
            model_name='product',
            name='location_device',
        ),
        migrations.RemoveField(
            model_name='product',
            name='microphone_app',
        ),
        migrations.RemoveField(
            model_name='product',
            name='microphone_device',
        ),

        # and rename the temporary fields back to their original name

        migrations.RenameField(
            model_name='product',
            old_name='camera_app_temp',
            new_name='camera_app',
        ),
        migrations.RenameField(
            model_name='product',
            old_name='camera_device_temp',
            new_name='camera_device',
        ),
        migrations.RenameField(
            model_name='product',
            old_name='location_app_temp',
            new_name='location_app',
        ),
        migrations.RenameField(
            model_name='product',
            old_name='location_device_temp',
            new_name='location_device',
        ),
        migrations.RenameField(
            model_name='product',
            old_name='microphone_app_temp',
            new_name='microphone_app',
        ),
        migrations.RenameField(
            model_name='product',
            old_name='microphone_device_temp',
            new_name='microphone_device',
        ),
    ]
