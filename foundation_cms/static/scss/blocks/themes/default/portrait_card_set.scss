@use "sass:map";
@use "sass:math";

$num-cards: 3;
$gap-between-cards: 1.5rem;
$card-gap-offset: calc(($gap-between-cards * ($num-cards - 1)) / $num-cards);
$carousel-transition: transform 0.4s ease;

.portrait-card-set {
  --carousel-transition: #{$carousel-transition};
  --card-radius: 1.5rem;

  $rotate-pos: 3deg;
  $rotate-neg: -3deg;
  $cardset-colors: (
    1: color(blue, "300"),
    2: color(yellow, "300"),
    3: color(orange, "200"),
    4: color(green, "300"),
  );
  @include breakpoint(large up) {
    --card-radius: 5.75rem;
  }

  border-radius: var(--card-radius);

  &__card-container {
    display: flex;
    flex-wrap: nowrap;
    overflow: hidden;
    max-width: 100%;
    position: relative;
    scrollbar-width: none;
  }

  &__controls {
    display: flex;
    justify-content: end;
    margin-top: 1rem;

    @include breakpoint(large up) {
      display: none;
    }
  }

  &.is-carousel {
    @include breakpoint(large up) {
      .portrait-card {
        width: 30%;
      }

      .portrait-card-set__controls {
        display: flex;
      }
    }
  }

  // Carousel-specific track container
  .carousel-track {
    display: flex;
    width: 100%;
    will-change: transform;
    transition: #{$carousel-transition};
  }

  .portrait-card {
    color: inherit;
    text-decoration: none;
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    min-height: 29.25rem;
    aspect-ratio: math.div(5, 8);
    box-sizing: border-box;
    width: 85%; // Mobile default
    scroll-snap-align: start;
    margin-right: 0.5rem;

    @include breakpoint(medium) {
      width: 45%; // Tablet
    }

    @include breakpoint(large up) {
      // For 3 cards in a row, subtract each card's share of the total row gap from 100%
      // 3 cards = 2 total gaps → 1.5rem total gap ÷ 3 cards = 0.5rem per card
      width: calc(100% / #{$num-cards} - #{$card-gap-offset});
      min-height: 44rem;
      padding: 2.5rem 3rem 4.5rem;

      &:not(:last-child) {
        margin-right: #{$gap-between-cards};
      }
    }

    &:last-child {
      margin-right: 0;
    }

    &__image {
      transition: #{$carousel-transition};
      aspect-ratio: math.div(1, 1);
      will-change: transform;

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }

    &__text {
      margin-top: auto;
    }

    &__headline {
      margin: 0;
      @include cta-link(map.get($cta-link-icon-sizes, regular), "regular");
      @include breakpoint(large) {
        @include cta-link(map.get($cta-link-icon-sizes, xlarge), "xlarge");
      }
      @include mofo-text-style($header-styles, "h4", $header-font-family);
    }

    .portrait-card__headline {
      text-wrap: wrap;

      ::after {
        will-change: transform;
      }
    }

    &:hover {
      .portrait-card__image {
        transform: scale(1.05);
      }

      .portrait-card__headline {
        text-decoration: underline;
      }

      .portrait-card__headline::after {
        transform: translateX(0.75rem);
      }
    }

    // Color theming via data attribute
    @for $i from 1 through 4 {
      &[data-card-color="#{$i - 1}"] {
        background-color: map.get($cardset-colors, $i);

        .portrait-card__image img {
          @if $i == 1 {
            border-radius: 0 var(--card-radius) 0 0;
            transform: rotate($rotate-neg);
          } @else if $i == 2 {
            border-radius: 0 var(--card-radius) var(--card-radius) 0;
            transform: rotate($rotate-pos);
          } @else if $i == 3 {
            border-radius: var(--card-radius) var(--card-radius) 0 0;
            transform: rotate($rotate-neg);
          } @else if $i == 4 {
            border-radius: 0 var(--card-radius) 0 var(--card-radius);
            transform: rotate($rotate-pos);
          }
        }
      }
    }
  }
}
