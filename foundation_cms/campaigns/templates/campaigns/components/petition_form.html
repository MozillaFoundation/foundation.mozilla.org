{% load i18n l10n wagtailcore_tags %}
{% get_current_language as LANGUAGE_CODE %}

<!-- To avoid linting messages while using trans tags without double quotes -->
{% trans "First Name" as first_name_label %}
{% trans "Last Name" as last_name_label %}
{% trans "Email" as email_label %}
{% trans "Country" as country_label %}
{% trans "Postal Code" as postal_code_label %}
{% trans "Comments" as comments_label %}

<form
    method="post"
    action="https://mozillafoundation.tfaforms.net/api_v2/workflow/processor"
    class="petition-form"
    id="petitionForm">

    <!-- Hidden FormAssembly fields (same as legacy) -->
    <input type="hidden" name="tfa_500" value="{{ request.build_absolute_uri }}?state=signed&medium=email" class="">
    <input type="hidden" name="tfa_1" value="{{ petition_cta.campaign_id }}" class="">
    <input type="hidden" name="tfa_498" value="{{ request.build_absolute_uri }}" class="">
    <input type="hidden" name="tfa_499" value="{{ LANGUAGE_CODE }}" class="">
    <input type="hidden" name="tfa_501" value="{{ petition_cta.newsletter }}" class="">

    <!-- Use CaMo form ID by default -->
    <input type="hidden" value="187" name="tfa_dbFormId" id="tfa_dbFormId">
    <input type="hidden" value="1d193b59297af95a7c351558364b25ac" name="tfa_dbControl" id="tfa_dbControl">
    <input type="hidden" value="32" name="tfa_dbVersionId" id="tfa_dbVersionId">

    <!-- Standard hidden FormAssembly fields -->
    <input type="hidden" value="" name="tfa_dbResponseId" id="tfa_dbResponseId">
    <input type="hidden" value="" name="tfa_dbWorkflowSessionUuid" id="tfa_dbWorkflowSessionUuid">
    <input type="hidden" value="" name="tfa_switchedoff" id="tfa_switchedoff">

    <!-- User input fields with FormAssembly field names -->
    <div class="form-group">
        <label for="tfa_28">{{ first_name_label }} *</label>
        <input type="text" id="tfa_28" name="tfa_28" required aria-required="true" title="{{ first_name_label }}" class="required">
    </div>

    <div class="form-group">
        <label for="tfa_30">{{ last_name_label }} *</label>
        <input type="text" id="tfa_30" name="tfa_30" required aria-required="true" title="{{ last_name_label }}" class="required">
    </div>

    <div class="form-group">
        <label for="tfa_31">{{ email_label }} *</label>
        <input type="email" id="tfa_31" name="tfa_31" required aria-required="true" title="{{ email_label }}" class="validate-email required">
    </div>

    <!-- Optional fields based on petition configuration -->
    {% if petition_cta.show_country_field %}
        <div class="form-group">
            <label for="tfa_254">{{ country_label }}</label>
            <select id="tfa_254" name="tfa_254" title="{{ country_label }}">
                <option value="">{{ "Please select..." }}</option>
                <option value="tfa_478">United States</option>
                <option value="tfa_292">Canada</option>
                <option value="tfa_477">United Kingdom</option>
                <option value="tfa_335">Germany</option>
                <option value="tfa_328">France</option>
            </select>
        </div>
    {% endif %}

    {% if petition_cta.show_postal_code_field %}
        <div class="form-group">
            <label for="tfa_496">{{ postal_code_label }}</label>
            <input type="text" id="tfa_496" name="tfa_496" title="{{ postal_code_label }}">
        </div>
    {% endif %}

    {% if petition_cta.show_comment_field %}
        <div class="form-group">
            <label for="tfa_497">{{ comments_label }}</label>
            <textarea id="tfa_497" name="tfa_497" maxlength="500" title="{{ comments_label }}"></textarea>
        </div>
    {% endif %}

    <!-- Newsletter opt-in -->
    <div class="form-group">
        <label>
            <input type="checkbox" name="tfa_495" value="tfa_495">
            {% trans "Yes, I want to receive email updates about Mozilla's campaigns." %}
        </label>
    </div>

    <!-- Privacy agreement -->
    <div class="form-group">
        <label>
            {% if petition_cta.privacy_notice %}
                {{ petition_cta.privacy_notice|safe }}
            {% else %}
                {% blocktrans with link="https://www.mozilla.org/privacy/websites/" %}By signing, you accept to Mozilla handling your info as explained in this <a href="{{ link }}" target="_blank">Privacy Notice</a>.{% endblocktrans %}
            {% endif %}
        </label>
    </div>

    <button type="submit" class="btn btn-primary">
        {{ petition_cta.cta_button_text|default:"Add my name" }}
    </button>

</form>
