{% load wagtailcore_tags wagtailimages_tags %}
{% if self.tabs %}
    <div class="tabs-container" id="tabs-container-{{ forloop.counter0 }}">
        {# Tab Navigation - Timeline style #}
        <ul class="tabs grid-x"
            data-tabs
            id="tabbed-content-{{ forloop.counter0 }}">
            {% for tab in self.tabs %}
                <li class="tabs-title cell small-12 medium-auto {% if forloop.first %}is-active{% endif %}">
                    <a href="#panel{{ forloop.counter }}-{{ forloop.parentloop.counter0 }}"
                       {% if forloop.first %}aria-selected="true"{% endif %}>
                        <strong>{{ tab.title }}</strong>
                        {% if tab.subtitle %}
                            <br>
                            <small>{{ tab.subtitle }}</small>
                        {% endif %}
                    </a>
                </li>
            {% endfor %}
        </ul>
        {# Horizontal line below tabs #}
        <div class="tab-timeline-divider"></div>
        {# Tab Panels with content - Full width #}
        <div class="tabs-content"
             data-tabs-content="tabbed-content-{{ forloop.counter0 }}">
            {% for tab in self.tabs %}
                <div class="tabs-panel {% if forloop.first %}is-active{% endif %}"
                     id="panel{{ forloop.counter }}-{{ forloop.parentloop.counter0 }}">
                    <div class="tab-content-container">
                        {% comment %} Text content {% endcomment %}
                        <div class="tab-content-text">
                            {% for block in tab.content %}
                                {% if block.block_type == 'rich_text' %}{{ block.value|richtext }}{% endif %}
                            {% endfor %}
                        </div>
                        
                        {% comment %} Check if any image blocks exist {% endcomment %}
                        {% with has_image=False %}
                            {% for block in tab.content %}
                                {% if block.block_type == 'image' and block.value.image %}
                                    {% if not has_image %}
                                        <div class="tab-image-block">
                                            {% include_block block %}
                                        </div>
                                        {% with has_image=True %}{% endwith %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}
