{% load wagtailcore_tags wagtailimages_tags static i18n %}

{% block block_content %}
  <div class="video-block">
    <div class="video-block__wrapper">
      {% with video_id=self.video_url|cut:"https://vimeo.com/" %}
        <iframe
          class="video-block__iframe"
          src="https://player.vimeo.com/video/{{ video_id }}"
          frameborder="0"
          allow="autoplay; fullscreen; picture-in-picture;"
          allowfullscreen
        >
        </iframe>
      {% endwith %}
    </div>

    {% if value.caption %}
      <p class="video-block__caption">
        {% if value.caption_url %}
          {% with link=value.caption_url.0 %}
            <a
              class="video-block__caption-link"
              href="{{ link.url }}"
              {% if link.new_window %}target="_blank" rel="noopener noreferrer"{% endif %}
            >
              {{ value.caption }}
            </a>
          {% endwith %}
        {% else %}
          {{ value.caption }}
        {% endif %}
      </p>
    {% endif %}
  </div>
{% endblock block_content %}
